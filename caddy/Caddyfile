{
	local_certs

# 	order authenticate before respond
# 	order authorize before basicauth

# 	security {
# 		local identity store localdb {
# 			realm local
# 			path {$HOME}/.local/caddy/users.json
# 		}

# 		oauth identity provider github {env.GITHUB_CLIENT_ID} {env.GITHUB_CLIENT_SECRET}

# 		authentication portal myportal {
# 			crypto default token lifetime 3600
# 			crypto key sign-verify {env.JWT_SHARED_KEY}
# 			enable identity store localdb
# 			enable identity provider github
# 			cookie domain myfiosgateway.com
# 			ui {
# 				links {
# 					"My Website" https://assetq.myfiosgateway.com:8443/ icon "las la-star"
# 					"Guests" https://assetq.myfiosgateway.com:8443/guests icon "las la-star"
# 					"Users" https://assetq.myfiosgateway.com:8443/users icon "las la-star"
# 					"Admins" https://assetq.myfiosgateway.com:8443/admins icon "las la-star"
# 					"My Identity" "/whoami" icon "las la-user"
# 				}
# 			}
# 			transform user {
# 				match origin local
# 				action add role authp/user
# 				ui link "Portal Settings" /settings icon "las la-cog"
# 			}
# 			transform user {
# 				match realm github
# 				match sub github.com/greenpau
# 				action add role authp/user
# 			}
# 		}

# 		authorization policy guests_policy {
# 			# disable auth redirect
# 			set auth url https://auth.myfiosgateway.com:8443/
# 			allow roles authp/admin authp/user
# 			crypto key verify {env.JWT_SHARED_KEY}
# 			acl rule {
# 				comment allow guests only
# 				match role guest authp/guest
# 				allow stop log info
# 			}
# 			acl rule {
# 				comment default deny
# 				match any
# 				deny log warn
# 			}
# 		}

# 		authorization policy users_policy {
# 			set auth url https://auth.myfiosgateway.com:8443/
# 			allow roles authp/admin authp/user
# 			crypto key verify {env.JWT_SHARED_KEY}
# 			acl rule {
# 				comment allow users
# 				match role authp/user
# 				allow stop log info
# 			}
# 			acl rule {
# 				comment default deny
# 				match any
# 				deny log warn
# 			}
# 		}

# 		authorization policy admins_policy {
# 			set auth url https://auth.myfiosgateway.com:8443/
# 			allow roles authp/admin authp/user
# 			crypto key verify {env.JWT_SHARED_KEY}
# 			acl rule {
# 				comment allow users
# 				match role authp/user
# 				allow stop log info
# 			}
# 			acl rule {
# 				comment default deny
# 				match any
# 				deny log warn
# 			}
# 		}
# 	}
# }

*.internship.local, internship.local {
	tls /certs/internship.local+1.pem /certs/internship.local+1-key.pem
}

http://growi.internship.local {
	reverse_proxy growi:3000
}

mm.internship.local {
	tls /certs/mattermost.crt /certs/mattermost.key
	reverse_proxy mattermost:8065
}

kc.internship.local {
	reverse_proxy keycloak:8080
}

gt.internship.local {
	reverse_proxy gitea:3000
}

http://test.internship.local {
	route {
		authenticate with myportal
	}
}
